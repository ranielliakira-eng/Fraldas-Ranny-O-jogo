<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fraldas Ranny - O Jogo</title>
    <style>
        /* Fundo da p√°gina PRETO conforme solicitado */
        body { margin: 0; background: #000; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { background: #fdfdfd; border: 8px solid #34495e; max-width: 95vw; max-height: 95vh; touch-action: none; box-shadow: 0 10px 50px rgba(0,0,0,0.8); }
        
        /* √Årea final RGB(71, 13, 28) com letras Brancas */
        #telaFinal { display: none; position: absolute; background: rgb(71, 13, 28); padding: 35px; border-radius: 20px; text-align: center; z-index: 10; width: 85%; max-width: 450px; border: 2px solid #fff; }
        #telaFinal h1 { color: #fff; margin: 0 0 10px; font-size: 2.2em; }
        #telaFinal p { color: #fff; font-size: 1.1em; line-height: 1.6; }
        
        #btnComoChegar { background-color: #27ae60; color: white; padding: 18px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 15px; }
        #joystickContainer { display: none; position: absolute; bottom: 40px; left: 40px; width: 110px; height: 110px; background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid #fff; }
        #joystickKnob { position: absolute; top: 30px; left: 30px; width: 50px; height: 50px; background: #fff; border-radius: 50%; opacity: 0.8; }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="joystickContainer"><div id="joystickKnob"></div></div>

<div id="telaFinal" style="display: none; position: absolute; background: rgb(71, 13, 28); padding: 35px; border-radius: 20px; text-align: center; z-index: 10; width: 85%; max-width: 450px; border: 2px solid #ffffff; box-shadow: 0 0 30px rgba(0,0,0,0.5);">
    <h1 style="color: #ffffff; margin: 0 0 15px; font-size: 2.2em;">Fraldas Ranny</h1>
    
    <p style="color: #ffffff; font-size: 1.2em; line-height: 1.6;">
        Parab√©ns! Voc√™ atendeu os clientes. Venha nos visitar na Estrada do Jaguar√©, 1706 - S√£o Paulo/SP
    </p>
    
    <button id="btnComoChegar" style="background-color: #27ae60; color: white; padding: 18px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;">
        üìç Como Chegar no Maps
    </button>
    
    <button onclick="location.reload()" style="background:none; border:1px solid #ffffff; color:#ffffff; padding:10px; margin-top:20px; cursor:pointer; border-radius: 5px; opacity: 0.8;">
        Jogar Novamente
    </button>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const telaFinalHTML = document.getElementById("telaFinal");
    const joystick = document.getElementById("joystickContainer");
    const knob = document.getElementById("joystickKnob");

    canvas.width = 800;
    canvas.height = 600;

    let estado = "JOGANDO";
    let score = 0;
    const TOTAL_CLIENTES = 3;

    // --- ENTIDADES ---
    const vendedor = { x: 400, y: 450, w: 45, h: 65, speed: 6, carrying: false, anim: 0 };
    const balcao = { x: 250, y: 150, w: 300, h: 70 };
    const estoque = { x: 40, y: 460, w: 140, h: 100 };
    let cliente = { x: 850, y: 160, w: 45, h: 65, status: "ENTRANDO", anim: 0 };

    // --- CONTROLES ---
    const teclas = {};
    let moveX = 0, moveY = 0;
    window.onkeydown = (e) => teclas[e.code] = true;
    window.onkeyup = (e) => teclas[e.code] = false;

    if ('ontouchstart' in window) {
        joystick.style.display = "block";
        joystick.addEventListener("touchmove", (e) => {
            const rect = joystick.getBoundingClientRect();
            moveX = (e.touches[0].clientX - (rect.left + 55)) / 55;
            moveY = (e.touches[0].clientY - (rect.top + 55)) / 55;
            const dist = Math.min(Math.sqrt(moveX*moveX + moveY*moveY), 1);
            const angle = Math.atan2(moveY, moveX);
            knob.style.transform = `translate(${Math.cos(angle)*dist*35}px, ${Math.sin(angle)*dist*35}px)`;
        });
        joystick.addEventListener("touchend", () => { moveX = 0; moveY = 0; knob.style.transform = "translate(0,0)"; });
    }

    function checkCollision(r1, r2) {
        return r1.x < r2.x + r2.w && r1.x + r1.w > r2.x && r1.y < r2.y + r2.h && r1.y + r1.h > r2.y;
    }

    function update() {
        if (estado !== "JOGANDO") return;
        let mov = false;
        if (teclas["ArrowRight"] || teclas["KeyD"]) { vendedor.x += vendedor.speed; mov = true; }
        if (teclas["ArrowLeft"] || teclas["KeyA"]) { vendedor.x -= vendedor.speed; mov = true; }
        if (teclas["ArrowUp"] || teclas["KeyW"]) { vendedor.y -= vendedor.speed; mov = true; }
        if (teclas["ArrowDown"] || teclas["KeyS"]) { vendedor.y += vendedor.speed; mov = true; }
        if (Math.abs(moveX) > 0.1 || Math.abs(moveY) > 0.1) { vendedor.x += moveX * vendedor.speed; vendedor.y += moveY * vendedor.speed; mov = true; }

        vendedor.x = Math.max(0, Math.min(canvas.width - vendedor.w, vendedor.x));
        vendedor.y = Math.max(0, Math.min(canvas.height - vendedor.h, vendedor.y));
        vendedor.anim += mov ? 0.2 : 0;

        if (cliente.status === "ENTRANDO") {
            cliente.x -= 3; cliente.anim += 0.15;
            if (cliente.x <= balcao.x + balcao.w - 50) cliente.status = "ESPERANDO";
        } else if (cliente.status === "SAINDO") {
            cliente.x += 4; cliente.anim += 0.2;
            if (cliente.x > 850) {
                if (score < TOTAL_CLIENTES) { cliente.x = 850; cliente.status = "ENTRANDO"; }
                else { estado = "FIM"; canvas.style.display="none"; joystick.style.display="none"; telaFinalHTML.style.display="block"; }
            }
        }

        if (!vendedor.carrying && checkCollision(vendedor, estoque)) vendedor.carrying = true;
        if (vendedor.carrying && cliente.status === "ESPERANDO" && checkCollision(vendedor, cliente)) {
            vendedor.carrying = false; cliente.status = "SAINDO"; score++;
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // --- CEN√ÅRIO DA LOJA ---
        // Piso em tom Pastel (Amadeirado claro)
        ctx.fillStyle = "#f3e5ab"; ctx.fillRect(0,0,800,600);
        
        // Tapete Central (√Årea de circula√ß√£o)
        ctx.fillStyle = "#e5d28a"; ctx.fillRect(100, 100, 600, 400);

        // Prateleiras de Fraldas (Decora√ß√£o nas paredes laterais)
        ctx.fillStyle = "#d7ccc8"; 
        for(let i=0; i<5; i++) {
            ctx.fillRect(720, 100 + (i*100), 60, 40); // Prateleira Direita
            ctx.fillRect(20, 100 + (i*100), 60, 40);  // Prateleira Esquerda
            ctx.fillStyle = "white"; ctx.fillRect(730, 105 + (i*100), 40, 20); // Simula√ß√£o de Pacotes
            ctx.fillRect(30, 105 + (i*100), 40, 20);
            ctx.fillStyle = "#d7ccc8";
        }

        // Desenhar Balc√£o (Recep√ß√£o)
        ctx.fillStyle = "#5d4037"; ctx.fillRect(balcao.x, balcao.y, balcao.w, balcao.h);
        ctx.fillStyle = "#fff"; ctx.font = "bold 16px Arial";
        ctx.fillText("RECEP√á√ÉO RANNY", balcao.x + 70, balcao.y + 40);

        // Desenhar Estoque
        ctx.fillStyle = "#6d4c41"; ctx.fillRect(estoque.x, estoque.y, estoque.w, estoque.h);
        ctx.fillStyle = "#fff"; ctx.fillText("ESTOQUE", estoque.x + 35, estoque.y + 55);

        // Cliente
        let kC = Math.abs(Math.sin(cliente.anim) * 8);
        ctx.fillStyle = "#ff5252"; ctx.fillRect(cliente.x, cliente.y - kC, cliente.w, cliente.h);
        if(cliente.status === "ESPERANDO") {
            ctx.fillStyle = "#000"; ctx.fillText("Ol√°! Quero fralda.", cliente.x - 30, cliente.y - 20);
        }

        // Vendedor
        let kV = Math.abs(Math.sin(vendedor.anim) * 8);
        ctx.fillStyle = "#4caf50"; ctx.fillRect(vendedor.x, vendedor.y - kV, vendedor.w, vendedor.h);
        if (vendedor.carrying) {
            ctx.fillStyle = "white"; ctx.fillRect(vendedor.x + 10, vendedor.y - 25 - kV, 25, 20);
            ctx.strokeStyle = "#000"; ctx.strokeRect(vendedor.x + 10, vendedor.y - 25 - kV, 25, 20);
        }

        // Interface Superior
        ctx.fillStyle = "rgb(71, 13, 28)"; ctx.font = "bold 24px Arial";
        ctx.fillText(`Atendimentos: ${score} / ${TOTAL_CLIENTES}`, 20, 50);
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }

    document.getElementById("btnComoChegar").onclick = () => {
        window.open(`www.google.com`, '_blank');
    };

    loop();
</script>
</body>
</html>
